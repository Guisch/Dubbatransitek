<!doctype html>
<html>

<head>
  <title>Dubbatransitek</title>
  <% include ../partials/head %>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.16/datatables.min.css" />
</head>

<body>
  <div class="container">
    <header>
      <% include ../partials/header %>
    </header>

    <!-- DISPLAY PLAYLIST -->
    <div class="row">
      <h1><%= lang.pages.advancedSearch %></h1>
      <table id="myTable" class="display" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th>
              <%= lang.pages.name %>
            </th>
            <th>
              <%= lang.pages.tagTitle %>
            </th>
            <th>
              <%= lang.pages.author %>
            </th>
            <th>
              <%= lang.pages.contributor %>
            </th>
            <th>
              <%= lang.pages.musicNb %>
            </th>
            <th>
              <%= lang.pages.go %>
            </th>
          </tr>
        </thead>

        <tfoot>
          <tr>
            <th>
              <%= lang.pages.name %>
            </th>
            <th>
              <%= lang.pages.tagTitle %>
            </th>
            <th>
              <%= lang.pages.author %>
            </th>
            <th>
              <%= lang.pages.contributor %>
            </th>
            <th>
              <%= lang.pages.musicNb %>
            </th>
            <th>
              <%= lang.pages.go %>
            </th>
          </tr>
        </tfoot>
        <tbody id="myTableBody">
        </tbody>
      </table>
    </div>
  </div>
</body>
<footer>
  <% include ../partials/notifJS %>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.16/datatables.min.js"></script>
    <script>
      var allPlaylists;
      socket.on('allPlaylists', function(playlists) {
        $('#myTableBody').empty();
        allPlaylists = playlists;
        for (var i = 0; i < playlists.length; i++) {
          var html = "<tr><td><a href='./musics?name=" + encodeURI(playlists[i].name) + "'>" + playlists[i].name + "</a></td>";
          html += "<td>" + playlists[i].tag.join(", ") + "</td>";
          html += "<td>" + ((playlists[i].author_id.local ? playlists[i].author_id.local.username : false) || (playlists[i].author_id.spotify ? playlists[i].author_id.spotify.username : false) || (playlists[i].author_id.deezer ? playlists[i].author_id
            .deezer.username : false) || (playlists[i].author_id.youtube ? playlists[i].author_id.youtube.displayName : false)) + "</td>";
          html += "<td>";
          for (var j = 0; j < playlists[i].musics.length; j++) {
            html += ((playlists[i].musics[j].contributor_id.local ? playlists[i].musics[j].contributor_id.local.username : false) || (playlists[i].musics[j].contributor_id.spotify ? playlists[i].musics[j].contributor_id.spotify.username : false) || (playlists[i].musics.contributor_id[
              j].deezer ? playlists[i].musics[j].contributor_id.deezer.username : false) || (playlists[i].musics[j].contributor_id.youtube ? playlists[i].musics[j].contributor_id.youtube.displayName : false));
            if (j < playlists[i].musics.length - 1) {
              html += ", ";
            }
          }
          html += "</td>";
          html += "<td>" + playlists[i].musics.length + "</td>";
          html += "<td><a class='btn btn-default' href='./musics?name=" + encodeURI(playlists[i].name) + "'><%= lang.pages.go %></a></td></tr>";

          $('#myTableBody').append(html);
        }

        $('#myTable').DataTable();
      });

      socket.emit('getAllPlaylists');
    </script>
</footer>

</html>
